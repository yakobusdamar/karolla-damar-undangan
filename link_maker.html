<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Link Maker — Kepada</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { padding-top: 1.5rem; background-color: #f8f9fa; }
      .card { border-radius: 12px; }
      .output-input { font-family: monospace; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-3">Link Maker</h5>
              <p class="text-muted small">Masukkan nama/handle di kolom <strong>Kepada</strong>. Hasil link akan muncul di bawah secara langsung. Mobile-friendly.</p>

              <form id="makerForm" autocomplete="off">
                <div class="mb-3">
                  <label for="kepada" class="form-label">Kepada</label>
                  <input type="text" class="form-control" id="kepada" placeholder="contoh: johndoe atau @johndoe" />
                  <div id="helpText" class="form-text">Boleh pakai @ di depan atau tidak — sistem akan membersihkan spasi otomatis.</div>
                </div>

                <div class="mb-3">
                  <label class="form-label">Tipe Link</label>
                  <select id="template" class="form-select">
                    <option value="https://example.com/to/{to}">Generic (https://example.com/to/{to})</option>
                    <option value="https://threads.net/@{to}">Threads profile (https://threads.net/@{to})</option>
                    <option value="mailto:{to}@example.com">Email (mailto:{to}@example.com)</option>
                    <option value="https://wa.me/?text=Hi%20{to}">WhatsApp (https://wa.me/?text=Hi {to})</option>
                  </select>
                </div>

                <div class="d-grid gap-2 d-sm-flex justify-content-sm-start">
                  <button type="button" id="generateBtn" class="btn btn-primary">Buat Link</button>
                  <button type="button" id="resetBtn" class="btn btn-outline-secondary">Reset</button>
                </div>
              </form>

              <hr />

              <div class="mb-2">
                <label for="output" class="form-label">Hasil Link</label>
                <div class="input-group">
                  <input type="text" id="output" class="form-control output-input" readonly aria-label="Hasil link" />
                  <button class="btn btn-outline-secondary" id="copyBtn" type="button">Copy</button>
                </div>
                <div class="form-text mt-1">Klik link untuk membuka di tab baru. Tombol <em>Copy</em> menyalin ke clipboard.</div>
              </div>

              <div class="mt-3 text-end">
                <small class="text-muted">Made simple • Mobile optimized • Bootstrap</small>
              </div>
            </div>
          </div>

          <div class="text-center mt-3 text-muted small">Tip: gunakan tipe <strong>Threads profile</strong> untuk membentuk tautan profil yang umum.</div>
        </div>
      </div>
    </div>

    <script>
      (function(){
        const kepada = document.getElementById('kepada');
        const output = document.getElementById('output');
        const template = document.getElementById('template');
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const resetBtn = document.getElementById('resetBtn');

        function sanitize(value) {
          if (!value) return '';
          // trim, remove leading @, and replace spaces with hyphen
          return value.trim().replace(/^@+/, '').replace(/\s+/g, '-');
        }

        function buildLink(rawTo, tpl) {
          const to = sanitize(rawTo);
          if (!to) return '';

          // For templates that include {to} we must encode appropriately.
          // For mailto we don't encode the @ that template already includes.
          const encoded = encodeURIComponent(to);

          return tpl.replace('{to}', encoded).replace(/{to\}/g, encoded);
        }

        function updateOutput() {
          const tpl = template.value;
          const val = kepada.value;
          const link = buildLink(val, tpl);
          output.value = link;
        }

        // Live update when user types
        kepada.addEventListener('input', updateOutput);
        template.addEventListener('change', updateOutput);

        // Generate button (also useful for accessibility)
        generateBtn.addEventListener('click', function(){
          updateOutput();
          if (output.value) {
            // open in new tab when clicking the generated link in output
            // but we won't auto-open; we just focus the output
            output.focus();
            output.select();
          }
        });

        // Copy to clipboard
        copyBtn.addEventListener('click', async function(){
          if (!output.value) return;
          try {
            await navigator.clipboard.writeText(output.value);
            copyBtn.innerText = 'Copied!';
            setTimeout(()=> copyBtn.innerText = 'Copy', 1300);
          } catch (e) {
            // fallback: select the text and execCopy
            output.select();
            document.execCommand('copy');
            copyBtn.innerText = 'Copied!';
            setTimeout(()=> copyBtn.innerText = 'Copy', 1300);
          }
        });

        // Reset
        resetBtn.addEventListener('click', function(){
          kepada.value = '';
          template.selectedIndex = 0;
          updateOutput();
        });

        // Make output clickable: open in new tab on Enter when focused
        output.addEventListener('keydown', function(e){
          if (e.key === 'Enter' && output.value) {
            window.open(output.value, '_blank', 'noopener');
          }
        });

        // Initial
        updateOutput();
      })();
    </script>
  </body>
</html>
